---
scenario:
  name: "How walking in the exoskeleton affects muscle coordination"
  description: "The rationale of this scenario is to characterize gait
    performance at the level of muscle coordination.
    It aims at characterizing how a user adapts to the exoskeleton walking and
    how the exoskeleton perturbs the operator’s control strategy and affects
    the spinal muscle coordination output.
    The proposed outcomes will provide important information about the neural
    control strategy and spinal locomotor output during walking with the
    exoskeleton, that will complement other performance indicators.
    While the scenario involves walking on a treadmill, it may also be extended
    to overgraound walking, walking on inclines, walking on uneven terrain,
    provided the reference data is updated for these scenarios by the user
    (PEPATO SW includes an option for the reference data update)."
  image: pepato/img0.png

protocol:
  - name: "pepato"
    name_readable: "Walking on a treadmill at 3 speeds"
    definition: "Several indicators of gait performance in the exoskeleton can
      be used based on kinematic/kinetic measurements, such as max speed,
      travelled distance, range of angular motion, joint torques, symmetry of
      lower limb movements, cognitive effort, etc.
      However, while such variables provide general characteristics of gait
      performance, only limited conclusions can be made about the neural control
      strategies based on these characteristics.
      Furthermore, some kinematic or kinetic parameters are a consequence of the
      control implemented on the exoskeleton.
      Therefore, standard indicators based on kinematics variables have
      limitations and need to be complemented by performance measures of muscle
      coordination and control strategy such as those generated by PEPATO.
      In particular, functional and structural changes at the spinal cord level
      induced by exoskeleton assisted walking can be mapped into muscle
      synergies and spinal maps of MN activity, as a means to look backward from
      the periphery to the central motor programming (Ivanenko et al. J
      Neurophysiol 2006, 95:602–618; Lacquaniti et al. J Physiol 2012,
      590:2189–2199; Martino et al. Clin Neurophysiol 2018, 129:516–525)."
    image: pepato/img1.png
    keywords: [walking]
    bipedal_system: [prosthesis, exoskeleton, human]
    pi_algo: undef
    duration: "10 minutes per run"
    controlled_variables:
      - name: treadmill speed
        definition: treadmill belt speed
        type: scalar
        range: [2, 4, 6]
        unit: km/h
    testbed:
      - item: "Any device to get gait information"
        type: sensor
        file_sheet: undef
      - item: "EMG system"
        type: sensor
        file_sheet: Check with Wearable facility
      - item: "Kinematic (or GRF) system to define gait (touchdown) events"
        type: sensor
        file_sheet: Check with Wearable facility
      - item: "treadmill"
        type: actuator
        file_sheet: Check with Wearable facility
    step_description: "Walking on a treadmill at a constant speed: 2, 4 and 6
      km/h.
      At least 10 consecutive strides should be recorded for each speed
      condition.
      PEPATO software also allows to characterize only one or two speed
      conditions in case the participant cannot perform all speed conditions
      (e.g., some exoskeletons allow only slow walking)."
    step_list:
      - description: Don exoskeleton
      - description: Instrument participant with EMG sensors and check
          functionality
      - description: If Vicon is used for gait events, instrument participant
          with markers and check functionality
      - description: Participant walks on treadmill at 2 Km/h for at least
          10 consecutive strides).
        detail: raw EMG data is collected in .csv file
          (subject_N_run_R_speed2kmh_emg.csv).
          Processed gait events are saved in a .yml file
          (subject_N_run_R_speed2kmh_gaitEvents.yml).
      - description: Participant walks on treadmill at 4 Km/h for at least 10
          consecutive strides.
        detail: Raw EMG data is collected in .csv file
          (subject_N_run_R_speed4kmh_emg.csv).
          Processed gait events are saved in a .yml file
          (subject_N_run_R_speed4kmh_gaitEvents.yml).
      - description: Participant walks on treadmill at 6 Km/h for at least 10
          consecutive strides
        detail: Raw EMG data is collected in .csv file
          (subject_N_run_R_speed6kmh_emg.csv).
          Processed gait events are saved in a .yml file
          (subject_N_run_R_speed6kmh_gaitEvents.yml).
      - description: Remove markers and EMG sensors
      - description: Doff exoskeleton
    has_multiple_run: false
    # TODO: 3 different speed, but needs to be processed together
    has_multiple_condition: false
    has_multiple_subject: undef

pi:
  - name: muscle_synergy_number
    name_readable: "Muscle synergy number"
    description: "The number of muscle synergies best describing the EMG data
      (for each speed).
      The larger the number of synergies the higher the
      dimensionality/complexity of muscle control."
    unit: na
    output: vector
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: Bar plot
    inter_cond_aggregation: na
    inter_subject_aggregation: [mean, std]
  - name: emg_reco_quality
    name_readable: "EMG reconstruction quality"
    description: "Reconstruction quality (R2) of EMG patterns from muscle
      synergies (for each speed).
      The larger the R2, the better the reconstruction of EMGs with muscle
      modules."
    unit: na
    output: vector
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: Bar plot
    inter_cond_aggregation: na
    inter_subject_aggregation: [mean, std]
  - name: pattern_fwhm
    name_readable: "Pattern FWHM"
    description: "FWHM (full width at half maximum) - duration estimate of basic
      patterns (for each speed).
      Wider basic activation patterns are typically associated with unstable
      walking conditions (Martino et al. J Neurophysiol 2015, 114(5):2867-82)."
    unit: "% of gait cycle"
    output: vector_of_vector
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: Stacked lines with markers
    inter_cond_aggregation: na
    # additional comment: , using matching_standard_reference_index PI
    inter_subject_aggregation: [mean, std]
  - name: pattern_coa
    name_readable: "Pattern COA"
    description: "centre-of-activity (CoA) of basic patterns (for each speed).
      The difference between CoA with that of the reference database would
      indicate significant changes in the timing of muscle module activation
      during walking in the exoskeleton."
    unit: "% of gait cycle"
    output: vector_of_vector
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: Stacked lines with markers
    inter_cond_aggregation: na
    # additional comment: , using matching_standard_reference_index PI
    inter_subject_aggregation: [circular mean, circular std]
  # TODO: the following one is not created in the example.
  - name: muscle_module_similarity
    name_readable: "Muscle module similarity"
    description: "The degree of similarity of muscle synergies and basic
      patterns with the reference group (4 module clusters for each speed) =
      the mean distance to the nearest module cluster center (measured in
      standard deviations). The smaller the distance, the smaller the deviation
      of the muscle modules (neural control) of exoskeleton walking from those
      of normal walking."
    unit: undef
    # TODO: more information in the excel sheet
    output: vector_of_matrix
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: Color coded 2D table
    inter_cond_aggregation: na
    # additional comment: , using matching_standard_reference_index PI
    inter_subject_aggregation: [mean, std]
  - name: matching_standard_reference_index
    name_readable: "matching_standard_reference_index"
    description: "This index is not PI but it is used for aggregation
      (inter-subject scoring) of the followint PIs: pattern_fwhm, pattern_coa,
      muscle_module_similarity.
      Each value corresponds to the index of the nearest module in the reference database. If the value is missing (NaN), the module does not match any in the reference."
    unit: undef
    output: vector_of_matrix
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: Color coded 2D table
    inter_cond_aggregation: na
    # additional comment: , using matching_standard_reference_index PI
    inter_subject_aggregation: [mean, std]
  - name: motor_pool_coact_index
    name_readable: "motor_pool_coact_index"
    description: undef
    unit: undef
    output: vector
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: undef
    inter_cond_aggregation: na
    inter_subject_aggregation: undef
  - name: motor_pool_fwhm
    name_readable: "motor_pool_fwhm"
    description: undef
    unit: undef
    output: matrix
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: undef
    inter_cond_aggregation: na
    inter_subject_aggregation: undef
  - name: motor_pool_max_activation
    name_readable: "motor_pool_max_activation"
    description: undef
    unit: undef
    output: matrix
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: undef
    inter_cond_aggregation: na
    inter_subject_aggregation: undef
  - name: motor_pool_similarity
    name_readable: "motor_pool_similarity"
    description: undef
    unit: undef
    output: matrix
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: undef
    inter_cond_aggregation: na
    inter_subject_aggregation: undef
  - name: patterns_similarity
    name_readable: "patterns_similarity"
    description: undef
    unit: undef
    output: vector_of_matrix
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: undef
    inter_cond_aggregation: na
    inter_subject_aggregation: undef
  - name: synergies_similarity
    name_readable: "synergies_similarity"
    description: undef
    unit: undef
    output: vector_of_matrix
    intra_run_aggregation: na
    inter_run_aggregation: na
    visu: undef
    inter_cond_aggregation: na
    inter_subject_aggregation: undef
pi_algo:
  - name: pi_pepato
    description: EMG analysis algorythms
    url_paper: undef
    url_code: https://github.com/dzhvansky/pepato/tree/octave_version
    docker_host: eurobenchtest/pi_pepato:v1.0.0
    docker_name: eurobenchtest/pi_pepato:v1.0.0
    pi:
      - muscle_synergy_number
      - emg_reco_quality
      - pattern_fwhm
      - pattern_coa
      - matching_standard_reference_index
      - motor_pool_coact_index
      - motor_pool_fwhm
      - motor_pool_max_activation
      - motor_pool_similarity
      - patterns_similarity
      - synergies_similarity
    input_files:
      - speed2kmh_emg.csv
      - speed2kmh_gaitEvents.yaml
      - speed4kmh_emg.csv
      - speed4kmh_gaitEvents.yaml
      - speed6kmh_emg.csv
    # todo: check docker entry point
    input_command:
      - run_pepato left BLF db_healthy_adults_8m
      - speed2kmh_emg.csv
      - speed2kmh_gaitEvents.yaml
      - speed4kmh_emg.csv
      - speed4kmh_gaitEvents.yaml
      - speed6kmh_emg.csv
    language: octave
    implemented: false
